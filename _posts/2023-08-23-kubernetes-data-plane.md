---
layout: post
title: "쿠버네티스 아키텍처 개념 정리 - Data Plane"
date: 2023-08-24
excerpt: "쿠버네티스 생초보 탈출 - with minikube"
tags: [kubernetes, backend]
comments: true
---

## 쿠버네티스 아키텍처

<img width="671" alt="스크린샷 2023-08-22 오후 8 01 00" src="https://github.com/MinChangJeong/minchangjeong.github.io/assets/65451455/ad8a0f36-ae6c-4c3e-9031-0f16cc9d6fe7">

* Control plane(Master mode) : 쿠버네티스 전체를 통제/관리
    * kube-apiserver
    * etcd
    * kube-schduler
    * kube-controller-manager(cloud-controller-manager)


* Data plane(Workder node) : 실제 사용자의 애플리케이션을 배포되어 컨테이너가 구동됨
    * kubelet
    * kube-proxy
    * container runtime

## kubelet

* 쿠버네티스 클러스터 내에서 각각의 워커 노드에 위치한 컴포넌트 중 하나로, 해당 워커 노드에서
컨테이너화된 어플리케이션들을 실행하고 관리하는 역할을 수행한다. 

예를 들어서 설명해자면 다음과 같다. 

워커 노드는 쿠버네티스 클러스터 안의 여러 작은 일꾼 집단이다. 클러스터는 하나의 큰 농장이라고 했을 때 이 농장에서는 여러 곳에 작은 집들이 있고 이 집의 이름을 '노드'라고 한다. 그리고 그 작은 집들에는 '컨테이너'라는 상자안에 다양한 물건들을 담아 놓을 수 있고 이 물건들은 '애플리케이션' 이라는 작업들이다. 

그 작은 집에는 일꾼들이 살고 있고 이른은 '워커 노드'이다. 이 일꾼 들은 컨테이너 안의 어플리케이션을 관리하고 실행합니다. 이 워커 노드들이 함께 협력하여 클러스터 안에서 다양한 작업들이 잘 수행될 수 있도록 도와주는 것이다. 

이 일꾼들을 관리하는 관리자의 이름은 'kubelet'이라고 한다. 마치 그 작은 집의 주인 역할이다. 예를 들어 집 안에 있는 각각의 일꾼들이 컨테이너 안의 어플리케이션을 제대로 실행하고 있는지, 문제가 생기면 어떻게 처리해야하는지 kubelet이 알고 있다. 그리고 일꾼들이 필요한 재료나 도구가 있으며 그것들을 가져다 줘서 일이 원할하게 진행되도록 도오준다. 

그리고 'kubelet'은 집의 상태와 일꾼들의 작업 내용을 마스터 주인에게 보고한다. 이를 바탕으로 마스터 주인은 모든 집과 일꾼들이 잘 동작하는지 확인하고 필요한 조치를 취할 수 있다. 이 마스터 주인의 이름은 '마스터 노드'이다. 


----

## kube proxy

* 쿠버네티스 클러스터 내에서 네트워크 통신을 관리하는 역하을 수행하는 컴포넌트 이다. 이를 통해 클러스터 내부 및 외부에서 서비스에 접근할 수 있는 경로를 설정하고 관리한다. 

* kube proxy는 다음과 같은 역할을 수행한다. 
    * 서비스 디스커버리 : 클러스터 내의 각각의 서비스에 대한 가상 IP를 만들어 준다. 
    * 로드 밸런싱
    * 패킷 전달 : 클러스터 내부와 외부에서 들어오는 패킷을 알맞은 파드로 전달
    * 클러스터 내부 통신 : 클러스터 내의 파드들은 서로 다른 노드에 있을 수 있다. 'kube proxy'는 이러한 파드들 간의 통신을 가능하게 한다. 

아까 예를 들었던 '농장'의 비유에 적용해보자. 

농장안에서는 길을 찾을 수 있는 안내 표지판이 존재한다. 이 안내 표지판은 'kube proxy'이라고 부른다. 농장아에는 여러 집들이 있고 각 집에는 다양한 사람들이 사는데 이 사람들은 서로 이야기 하고 물건을 주고 받아야 할 때가 있다. 

그런데 집들이 너무 많고 복잡해서 어떤 집을 가야 할지, 어떻게 대화해야 할지 알기 어려울 때가 있다. 그럴때 이 'kube proxy'는 각 집에 가상의 주소를 붙여주고 다른 집들과 어떻게 통신해야하는지 방법을 알려준다. 때문에 집들은 서로 찾아갈 수 있고 물건이나 이야기를 주고 받을 수 있다.

또한 'kube proxy' 집들 사이에 길이 없을 수 있는 경우에 필요한 길을 만들어주서 물건을 주고 받을 수 있도록 도와준다. 

----

## container-runtime

* 컨테이너 런타임이란 컨테이너화된 어플리케이션을 실행하고 관리하는 소프트웨어이다. 컨테이너 이미지를 실제로 실행 가능한 프로세스로 변환하며, 컨이너 내부의 프로세스들을 격리하고 관리한다. 

실제로 컨테이너를 실행시키는 런타임 환경으로 가장 많이 사용하는 런타임으로 Docker를 사용했지만,2020년 11월에 쿠버네티스 공식적으로 도커를 제외했다. 

그래서 containerd나 CRI-O를 사용한다. 도커가 제외된 이유는 도커가 컨테이너 런타임 인터페이스를 지원하지 않기 때문에 docker-shim이라는 프록시를 사용해야만 했는데 쿠버네티스에서 docker-shim으로 변환하늗네 비효율적이라고 판단했기 때문이다. 자세한 내용은 [이 분의 블로그](https://ikcoo.tistory.com/189)를 참고하자



